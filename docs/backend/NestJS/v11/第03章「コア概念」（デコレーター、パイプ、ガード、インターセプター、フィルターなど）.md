---
id: 3
sidebar_position: 3
---
# ç¬¬03ç«  ã‚³ã‚¢æ¦‚å¿µ

NestJS ã¯ **ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼** ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ã•ã¾ã–ã¾ãªå…±é€šå‡¦ç†ã‚’ç›´æ„Ÿçš„ã«å®Ÿè£…ã§ãã¾ã™ã€‚ä»£è¡¨çš„ãªä»•çµ„ã¿ã¯ä»¥ä¸‹ã®5ã¤ã§ã™ã€‚

- ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆDecoratorsï¼‰
- ãƒ‘ã‚¤ãƒ—ï¼ˆPipesï¼‰
- ã‚¬ãƒ¼ãƒ‰ï¼ˆGuardsï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆInterceptorsï¼‰
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆException Filtersï¼‰

------

### 3.1 ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆDecoratorsï¼‰

- å½¹å‰²ï¼šã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã«ã€Œãƒ¡ã‚¿æƒ…å ±ã€ã‚’ä»˜ä¸ã™ã‚‹ä»•çµ„ã¿ã€‚
- NestJS ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚„ DI ã®ä¸­å¿ƒçš„å­˜åœ¨ã€‚

ğŸ“Œ ä¾‹ï¼š

```ts
@Controller('users')
export class UsersController {
  @Get(':id')
  findOne(@Param('id') id: string) {
    return `User #${id}`;
  }
}
```

- `@Controller('users')` â†’ `/users` ãƒ«ãƒ¼ãƒˆã‚’å®šç¾©
- `@Get(':id')` â†’ `/users/:id` ã«å¯¾å¿œ
- `@Param('id')` â†’ URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—

------

### 3.2 ãƒ‘ã‚¤ãƒ—ï¼ˆPipesï¼‰

- **å½¹å‰²**ï¼šãƒ‡ãƒ¼ã‚¿ã® **å¤‰æ›** ã¨ **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ã€‚
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¦ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«æ¸¡ã™å‰ã«æ•´å½¢ã§ãã‚‹ã€‚

ğŸ“Œ çµ„ã¿è¾¼ã¿ä¾‹ï¼š

- `ValidationPipe` â†’ DTO ã‚’ä½¿ã£ã¦å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼
- `ParseIntPipe` â†’ æ–‡å­—åˆ—ã‚’æ•°å€¤ã«å¤‰æ›

ğŸ“Œ ã‚µãƒ³ãƒ—ãƒ«ï¼š

```ts
@Get(':id')
findOne(@Param('id', ParseIntPipe) id: number) {
  return `User #${id}`;
}
```

â¡ï¸ `GET /users/5` â†’ `id` ã¯ **æ•°å€¤ 5** ã¨ã—ã¦å—ã‘å–ã‚Œã‚‹ã€‚

------

### 3.3 ã‚¬ãƒ¼ãƒ‰ï¼ˆGuardsï¼‰

- **å½¹å‰²**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«ã€Œè¨±å¯ã™ã‚‹ã‹ã€ã‚’åˆ¤å®šã™ã‚‹ã€‚
- èªè¨¼ãƒ»èªå¯ï¼ˆAuthorizationï¼‰ã«ä½¿ã†ã®ãŒä¸€èˆ¬çš„ã€‚

ğŸ“Œ ä¾‹ï¼šãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆã‚¬ãƒ¼ãƒ‰

```ts
import { CanActivate, ExecutionContext, Injectable } from '@nestjs/common';

@Injectable()
export class AuthGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const req = context.switchToHttp().getRequest();
    return !!req.user; // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒã‚ã‚Œã°è¨±å¯
  }
}
```

â¡ï¸ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é©ç”¨ï¼š

```ts
@UseGuards(AuthGuard)
@Get('profile')
getProfile() {
  return 'This is profile page';
}
```

------

### 3.4 ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆInterceptorsï¼‰

- **å½¹å‰²**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® **å‰å¾Œå‡¦ç†** ã‚’æŒŸã¿è¾¼ã‚€ã€‚
- ä¸»ãªç”¨é€”ï¼š
  - ãƒ­ã‚®ãƒ³ã‚°
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - ä¾‹å¤–ã®å…±é€šå‡¦ç†

ğŸ“Œ ä¾‹ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼

```ts
import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';
import { map } from 'rxjs/operators';

@Injectable()
export class TransformInterceptor implements NestInterceptor {
  intercept(context: ExecutionContext, next: CallHandler) {
    return next.handle().pipe(map(data => ({ data, success: true })));
  }
}
```

â¡ï¸ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒ `{ data: ..., success: true }` å½¢å¼ã«çµ±ä¸€ã•ã‚Œã‚‹ã€‚

------

### 3.5 ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆException Filtersï¼‰

- **å½¹å‰²**ï¼šä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã—ã€çµ±ä¸€çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ NestJS ãŒ `HttpException` ã‚’å‡¦ç†ã™ã‚‹ãŒã€ã‚«ã‚¹ã‚¿ãƒ å¯èƒ½ã€‚

ğŸ“Œ ä¾‹ï¼šã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

```ts
import { ExceptionFilter, Catch, ArgumentsHost, HttpException } from '@nestjs/common';

@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse();
    const status = exception.getStatus();

    response.status(status).json({
      statusCode: status,
      message: exception.message,
    });
  }
}
```

â¡ï¸ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é©ç”¨ï¼š

```ts
@UseFilters(HttpExceptionFilter)
@Get()
findAll() {
  throw new HttpException('Forbidden', 403);
}
```

------

### 3.6 ã¾ã¨ã‚

- **ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼**ï¼šNestJS ã®åŸºæœ¬çš„ãªæ§‹æ–‡ï¼ˆãƒ«ãƒ¼ãƒˆãƒ»ä¾å­˜æ€§æ³¨å…¥ãªã©ï¼‰ã€‚
- **ãƒ‘ã‚¤ãƒ—**ï¼šãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›ãƒ»æ¤œè¨¼ã€‚
- **ã‚¬ãƒ¼ãƒ‰**ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã€‚
- **ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼**ï¼šå‰å¾Œå‡¦ç†ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ãƒ­ã‚°ã‚’æ“ä½œã€‚
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**ï¼šä¾‹å¤–ã‚’ä¸€å…ƒç®¡ç†ã—ã€çµ±ä¸€çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã€‚